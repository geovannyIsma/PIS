{% extends 'base.html' %}

{% block title %} Predicciones de Datos Históricos {% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.3.2/dist/echarts.min.js"></script>

    <style>
        #downloadButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        body.dark .card {
            --card-bg-color: #333;
            --card-text-color: #ccc;
        }

        body.light .card {
            --card-bg-color: #fff;
            --card-text-color: #333;
        }

    </style>
{% endblock %}


{% block content %}
    <nav style="--bs-breadcrumb-divider: '▶';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'home' %}">Inicio</a></li>
            <li class="breadcrumb-item active" aria-current="page">Predicciones</li>
        </ol>
    </nav>

    <h2>Predicciones en base a datos históricos de la carrera de Computación de la UNL</h2>
    <div id="chart" style="width: 100%; height: 600px;"></div>
    <script>
        const data = {{ data|safe }};

        const periods = data.periodos;
        const matriculados = data.matriculados;
        const aprobados = data.aprobados;
        const reprobados = data.reprobados;
        const desertores = data.desertores;
        const abandono = data.abandono;

        const chart = echarts.init(document.getElementById('chart'));

        const updateChart = () => {
            const isDarkMode = document.body.classList.contains('dark');

            const option = {
                backgroundColor: isDarkMode ? '#18191a' : '#fff',
                title: {
                    text: 'Predicción de Deserción de Estudiantes',
                    textStyle: {
                        color: isDarkMode ? '#ccc' : '#333'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    textStyle: {
                        color: isDarkMode ? '#ccc' : '#333'
                    },
                    backgroundColor: isDarkMode ? '#555' : '#fff'
                },
                legend: {
                    data: ['Matriculados', 'Aprobados', 'Reprobados', 'Desertores', 'Abandono'],
                    textStyle: {
                        color: isDarkMode ? '#ccc' : '#333'
                    }
                },
                xAxis: {
                    type: 'category',
                    data: periods,
                    axisLine: {lineStyle: {color: isDarkMode ? '#ccc' : '#333'}},
                    axisLabel: {textStyle: {color: isDarkMode ? '#ccc' : '#333'}}
                },
                yAxis: {
                    type: 'value',
                    axisLine: {lineStyle: {color: isDarkMode ? '#ccc' : '#333'}},
                    axisLabel: {textStyle: {color: isDarkMode ? '#ccc' : '#333'}}
                },
                series: [
                    {
                        name: 'Matriculados',
                        type: 'line',
                        data: matriculados,
                        itemStyle: {
                            color: isDarkMode ? '#d87c7c' : '#5470c6'
                        }
                    },
                    {
                        name: 'Aprobados',
                        type: 'line',
                        data: aprobados,
                        itemStyle: {
                            color: isDarkMode ? '#91c7ae' : '#91c7ae'
                        }
                    },
                    {
                        name: 'Reprobados',
                        type: 'line',
                        data: reprobados,
                        itemStyle: {
                            color: isDarkMode ? '#c23531' : '#c23531'
                        }
                    },
                    {
                        name: 'Desertores',
                        type: 'line',
                        data: desertores,
                        itemStyle: {
                            color: isDarkMode ? '#6f42c1' : '#6f42c1'
                        }
                    },
                    {
                        name: 'Abandono',
                        type: 'line',
                        data: abandono,
                        itemStyle: {
                            color: isDarkMode ? '#ff8c00' : '#ff8c00'
                        }
                    }
                ]
            };

            chart.setOption(option);
        };

        updateChart();

        const observer = new MutationObserver(() => {
            updateChart();
        });

        observer.observe(document.body, {attributes: true, attributeFilter: ['class']});
    </script>
{% endblock %}


