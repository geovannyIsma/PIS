{% extends 'base.html' %}

{% block title %} Predicciones de Datos Hist칩ricos {% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        #downloadButton {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
{% endblock %}

{% block content %}
    <h1 class="p-4">Predicciones de Datos Hist칩ricos</h1>
    <div id="main" style="width: 100%; height: 600px;"></div>
    <button id="downloadButton" class="btn btn-dark mb-3">
        <i class="fas fa-download"></i> Descargar Gr치fica
    </button>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
    <script>
        var periodos = {{ periodos|safe }};
        var matriculados = {{ matriculados|safe }};
        var reprobados = {{ reprobados|safe }};
        var abandonaron = {{ abandonaron|safe }};
        var aprobados = {{ aprobados|safe }};
        var aplazadores = {{ aplazadores|safe }};
        var desertores = {{ desertores|safe }};
        var nuevos_periodos = {{ nuevos_periodos|safe }};

        var prediccion_matriculados = {{ prediccion_matriculados|safe }};
        var prediccion_reprobados = {{ prediccion_reprobados|safe }};
        var prediccion_abandonaron = {{ prediccion_abandonaron|safe }};
        var prediccion_aprobados = {{ prediccion_aprobados|safe }};
        var prediccion_aplazadores = {{ prediccion_aplazadores|safe }};
        var prediccion_desertores = {{ prediccion_desertores|safe }};

        var option = {
            title: {
                text: 'Predicciones de Datos Hist칩ricos'
            },
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['Matriculados', 'Reprobados', 'Abandonaron', 'Aprobados', 'Aplazadores', 'Desertores']
            },
            xAxis: {
                type: 'category',
                name: 'Periodo',
                data: periodos.concat(nuevos_periodos)
            },
            yAxis: {
                type: 'value',
                name: 'Valores'
            },
            series: [
                {
                    name: 'Matriculados',
                    type: 'line',
                    data: matriculados.concat(prediccion_matriculados)
                },
                {
                    name: 'Reprobados',
                    type: 'line',
                    data: reprobados.concat(prediccion_reprobados)
                },
                {
                    name: 'Abandonaron',
                    type: 'line',
                    data: abandonaron.concat(prediccion_abandonaron)
                },
                {
                    name: 'Aprobados',
                    type: 'line',
                    data: aprobados.concat(prediccion_aprobados)
                },
                {
                    name: 'Aplazadores',
                    type: 'line',
                    data: aplazadores.concat(prediccion_aplazadores)
                },
                {
                    name: 'Desertores',
                    type: 'line',
                    data: desertores.concat(prediccion_desertores)
                }
            ]
        };

        var chart = echarts.init(document.getElementById('main'));
        chart.setOption(option);

        document.getElementById('downloadButton').addEventListener('click', function () {
            var url = chart.getDataURL({
                type: 'png',
                pixelRatio: 2,
                backgroundColor: '#fff'
            });
            var link = document.createElement('a');
            link.href = url;
            link.download = 'predicciones_datos_historicos.png';
            link.click();
        });
    </script>
{% endblock %}
